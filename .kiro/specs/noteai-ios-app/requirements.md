# NoteAI iOS App - 要件定義

## 1. プロジェクト概要

### 1.1 基本情報
- **プロジェクト名**: NoteAI
- **プラットフォーム**: iOS (iPhone専用、将来的にiPad対応)
- **開発言語**: Swift 5.9+
- **最小対応OS**: iOS 16.0
- **開発ツール**: Xcode 15.0+, Claude Code
- **アーキテクチャ**: MVVM + Clean Architecture

### 1.2 製品ビジョン
**「プライバシーファーストで高機能なAI音声分析アプリ」**

- **無料版**: 完全ローカル処理による高品質文字起こし
- **有料版**: ユーザー自身のAPIキーによる無制限AI機能利用
- **プロジェクト管理**: 会議・講義・インタビューを体系的に整理

### 1.3 核心価値提案
1. **プライバシー保護**: ローカル処理でデータ外部流出ゼロ
2. **コスト透明性**: API利用料金の完全見える化
3. **高精度AI**: 最新LLM（GPT-4、Claude、Gemini）への直接アクセス
4. **プロジェクト統合**: 複数録音を横断した総合的なAI分析

## 2. 機能要件

### 2.1 録音機能

#### 2.1.1 基本録音機能
- **バックグラウンド録音**: アプリ終了時も継続録音
- **録音制御**: 一時停止・再開・停止
- **音声監視**: リアルタイム音声レベルインジケーター
- **品質設定**: 高音質（44.1kHz）/標準（22kHz）/省容量（16kHz）
- **ファイル形式**: m4a（標準）/ wav（高音質）

#### 2.1.2 ウィジェット機能
- **ホーム画面ウィジェット**: ワンタップ録音開始
- **録音状態表示**: 録音中/停止中のリアルタイム表示
- **クイックアクセス**: 直近録音への即座アクセス
- **プロジェクト選択**: ウィジェットから録音先プロジェクト選択

#### 2.1.3 録音管理
- **自動命名**: 日時ベースまたはカスタムタイトル
- **メタデータ**: 録音時間、日付、場所情報（オプション）
- **音声プレビュー**: 録音前の音声レベル確認機能

### 2.2 文字起こし機能

#### 2.2.1 ローカル文字起こし（無料版）
- **WhisperKit統合**: オンデバイス文字起こし
- **モデル選択**: tiny（軽量）/base（標準）/small（高精度）
- **多言語対応**: 日本語、英語、中国語、韓国語など
- **オフライン動作**: インターネット接続不要
- **プライバシー保護**: データ外部送信なし

#### 2.2.2 API文字起こし（有料版）
- **Whisper API**: OpenAI Whisper API統合
- **高精度処理**: 大容量ファイル対応
- **カスタム設定**: 温度、プロンプト調整
- **話者分離**: API経由での高精度話者識別

#### 2.2.3 文字起こし後処理
- **手動編集**: 文字起こし結果の修正機能
- **タイムスタンプ**: 音声とテキストの同期
- **セグメント管理**: 発言ごとの区切り表示

### 2.3 プロジェクト管理機能

#### 2.3.1 プロジェクト基本機能
- **プロジェクト作成**: 会議・講義・インタビュー等の用途別管理
- **録音グループ化**: 複数録音の関連付け
- **プロジェクトメタデータ**: 
  - カバー画像/アイコン設定
  - 説明・メモ機能
  - 参加者情報
  - タグ付け機能

#### 2.3.2 プロジェクト統計
- **録音統計**: 総録音数、総時間、期間
- **参加者分析**: 話者別発言時間、頻度
- **進捗追跡**: プロジェクト進行状況の可視化

#### 2.3.3 プロジェクト整理
- **フォルダ構造**: プロジェクトの階層管理
- **検索機能**: プロジェクト名、内容での検索
- **ソート機能**: 日付、時間、名前での並び替え

### 2.4 AI機能

#### 2.4.1 ローカルAI（無料版）
- **基本要約**: テンプレートベースの簡易要約
- **キーワード抽出**: 重要語句の自動抽出
- **感情分析**: 基本的な感情傾向分析

#### 2.4.2 外部API AI（有料版）
- **対応プロバイダー**:
  - OpenAI (GPT-4, GPT-3.5-turbo)
  - Google Gemini (Gemini Pro, Gemini Pro Vision)
  - Anthropic Claude (Claude-3-Sonnet, Claude-3-Haiku)

- **高度な機能**:
  - カスタムプロンプト
  - 文脈理解型要約
  - 質問応答（AskAI）
  - 多角的分析

#### 2.4.3 プロジェクト統合AI
- **プロジェクト横断分析**: 全録音を統合したコンテキスト
- **時系列分析**: プロジェクト進展の追跡
- **比較分析**: 複数会議の比較・変化点抽出
- **アクションアイテム抽出**: TODO・決定事項の自動抽出

### 2.5 RAG（検索・知識統合）機能

#### 2.5.1 基本検索（無料版）
- **キーワード検索**: 録音内容のテキスト検索
- **フィルタ機能**: 日付、プロジェクト、話者での絞り込み
- **検索履歴**: 過去の検索クエリ保存

#### 2.5.2 高度な検索（有料版）
- **セマンティック検索**: 意味ベースでの検索
- **ベクトル検索**: 類似内容の自動発見
- **関連性ランキング**: 検索結果の関連度順表示

#### 2.5.3 ドキュメント統合（有料版）
- **ファイル取り込み**: PDF、Word、テキストファイル
- **Webページ取り込み**: URLからの内容抽出
- **統合検索**: 録音＋ドキュメントの横断検索
- **知識ベース**: プロジェクト固有の知識蓄積

### 2.6 APIキー管理システム（有料版コア機能）

#### 2.6.1 セキュア管理
- **Keychain保存**: iOS Keychainによる暗号化保存
- **デバイス固有暗号化**: Face ID/Touch ID連携
- **APIキー検証**: 設定時の有効性確認
- **自動ローテーション**: セキュリティ向上のための定期更新提案

#### 2.6.2 使用量監視
- **リアルタイムトラッキング**: API呼び出し毎の使用量記録
- **コスト計算**: トークン数・音声時間からの料金推算
- **使用量可視化**: グラフ・チャートでの使用傾向表示
- **月次レポート**: 月間使用量とコストサマリー

#### 2.6.3 コスト管理
- **使用量上限**: プロバイダー別の月間上限設定
- **アラート機能**: 80%/90%/100%達成時の通知
- **自動停止**: 上限達成時のAPI利用停止（オプション）
- **予算計画**: 月間予算に基づく使用量配分

### 2.7 外部連携

#### 2.7.1 Limitless API統合（有料版）
- **Pendantデバイス連携**: ウェアラブルデバイスとの同期
- **自動録音開始**: デバイス検出時の自動録音
- **メタデータ統合**: デバイスからの環境情報取得

#### 2.7.2 エクスポート機能
- **音声エクスポート**: 元音声ファイルの書き出し
- **テキストエクスポート**: 文字起こし結果のテキスト出力
- **レポートエクスポート**: PDF形式での総合レポート
- **Markdown出力**: 構造化されたMarkdown形式

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **アプリ起動時間**: 2秒以内
- **録音開始時間**: タップから1秒以内
- **文字起こし速度**: 1分音声につき30秒以内（ローカル）
- **メモリ使用量**: 200MB以下（録音中）
- **バッテリー消費**: 1時間録音で10%以下

### 3.2 可用性要件
- **クラッシュ率**: 0.1%以下
- **データ保存信頼性**: 99.9%以上
- **オフライン動作**: 基本機能の完全オフライン対応

### 3.3 セキュリティ要件
- **データ暗号化**: 保存データの暗号化
- **API通信**: HTTPS必須
- **認証**: 生体認証対応
- **プライバシー**: ローカル処理優先

### 3.4 互換性要件
- **iOS対応**: 16.0以上
- **デバイス対応**: iPhone（iPad将来対応）
- **音声形式**: m4a、wav、mp3対応

## 4. ユーザーストーリー

### 4.1 基本利用フロー

#### ストーリー1: 会議録音
```
ユーザーとして、
会議の音声を録音し、自動で文字起こしして、
後で内容を検索・参照できるようにしたい。

受け入れ条件:
- ワンタップで録音開始
- バックグラウンド録音継続
- 録音終了後、自動文字起こし実行
- 文字起こし結果をプロジェクトに保存
```

#### ストーリー2: プロジェクト管理
```
ユーザーとして、
関連する複数の会議録音をプロジェクトとしてまとめ、
プロジェクト全体の進捗を把握したい。

受け入れ条件:
- プロジェクト作成・命名
- 録音のプロジェクト割り当て
- プロジェクト統計表示
- プロジェクト検索機能
```

#### ストーリー3: AI分析利用
```
有料ユーザーとして、
自分のAPIキーを設定して、
プロジェクト全体に対して質問・分析を行いたい。

受け入れ条件:
- APIキーの安全な保存
- 使用量監視・アラート
- プロジェクト横断AI分析
- コスト管理機能
```

### 4.2 有料版移行フロー

#### フェーズ1: 無料版体験
1. アプリダウンロード・インストール
2. 基本録音機能の利用
3. ローカル文字起こしで価値実感
4. プロジェクト管理機能の活用

#### フェーズ2: 有料版検討
1. 高度なAI機能の必要性認識
2. API利用の利点理解
3. コスト透明性の確認
4. 有料プラン登録

#### フェーズ3: 高度な機能活用
1. APIキー設定・検証
2. 使用量監視設定
3. プロジェクトAI分析開始
4. RAG機能・ドキュメント統合

## 5. 技術要件

### 5.1 開発環境
```swift
// Package.swift依存関係
dependencies: [
    // AI/ML
    .package(url: "https://github.com/argmaxinc/WhisperKit", from: "0.5.0"),
    
    // ネットワーク
    .package(url: "https://github.com/Alamofire/Alamofire", from: "5.8.0"),
    
    // データベース
    .package(url: "https://github.com/groue/GRDB.swift", from: "6.0.0"),
    
    // UI
    .package(url: "https://github.com/SDWebImage/SDWebImageSwiftUI", from: "2.2.0"),
    
    // 課金
    .package(url: "https://github.com/RevenueCat/purchases-ios", from: "4.0.0"),
    
    // Firebase
    .package(url: "https://github.com/firebase/firebase-ios-sdk", from: "10.0.0"),
    
    // Markdown
    .package(url: "https://github.com/johnxnguyen/Down", from: "0.11.0")
]
```

### 5.2 データモデル設計
```swift
// Core Dataエンティティ
entity Project {
    id: UUID
    name: String
    description: String?
    coverImageData: Data?
    createdAt: Date
    updatedAt: Date
    recordings: [Recording] // 1対多
}

entity Recording {
    id: UUID
    title: String
    audioFileURL: String
    transcription: String?
    transcriptionMethod: String // "local" or "api"
    duration: Double
    project: Project? // 多対1
}

entity Subscription {
    type: String // "free" or "premium"
    isActive: Bool
    expirationDate: Date?
    receiptData: Data?
}
```

## 6. 制約事項・前提条件

### 6.1 技術制約
- iOS 16.0以上必須（WhisperKit要件）
- 最小ストレージ: 2GB空き容量
- マイクアクセス権限必須
- インターネット接続（API機能利用時）

### 6.2 ビジネス制約
- APIキーはユーザー自身で取得・管理
- API利用料金はユーザー負担
- App Store Review Guidelines準拠必須

### 6.3 プライバシー制約
- 録音データのローカル保存原則
- ユーザー同意なしの外部送信禁止
- GDPR・個人情報保護法準拠

## 7. 成功指標・KPI

### 7.1 技術指標
- **文字起こし精度**: 95%以上（日本語）
- **アプリ起動時間**: 2秒以内
- **クラッシュ率**: 0.1%以下
- **バッテリー消費**: 1時間録音で10%以下

### 7.2 ビジネス指標
- **ダウンロード数**: 月間1,000DL以上
- **有料転換率**: 5%以上
- **月次継続率**: 80%以上
- **App Storeレーティング**: 4.5以上

### 7.3 ユーザー体験指標
- **録音完了率**: 95%以上
- **文字起こし利用率**: 80%以上
- **プロジェクト機能利用率**: 60%以上
- **API設定完了率**: 90%以上（有料ユーザー）

## 8. リスク・課題

### 8.1 技術リスク
- WhisperKitの性能制限
- iOSバージョン互換性
- メモリ・ストレージ制限

### 8.2 ビジネスリスク
- API料金変動による影響
- 競合アプリの登場
- App Store審査による機能制限

### 8.3 対応策
- 複数の文字起こしエンジン対応
- 段階的機能リリース
- ユーザーフィードバック重視の開発

この要件定義により、プライバシーを重視しつつ高機能なAI音声分析アプリを、持続可能なビジネスモデルで提供することを目指します。